import g from"@typo3/backend/modal.js";import{SeverityEnum as o}from"@typo3/backend/enum/severity.js";import p from"@typo3/backend/severity.js";import m from"@typo3/core/ajax/ajax-request.js";class w{checkAndShowModal=async(e,t,n={})=>{if(e!=="pages")return!0;const a=Number.parseInt(t,10);if(!Number.isInteger(a))return!0;const r=await this.fetchChildInfo(a);return r?r.hasChildren?r.isAllowed?this.promptWarning(r):(this.showErrorModal(r),!1):this.showStandardConfirmation():this.showStandardConfirmation()};async fetchChildInfo(e){try{const t=TYPO3.settings.ajaxUrls.ajax_page_deletion_guard_check_children||TYPO3.settings.ajaxUrls.page_deletion_guard_check_children;return t?await(await new m(t).withQueryArguments({pageUid:e}).get()).resolve():null}catch{return null}}showStandardConfirmation(){return new Promise(e=>{g.confirm(TYPO3.lang["standard.title"]||"Delete this record?",TYPO3.lang["standard.message"]||"Are you sure you want to delete this page?",o.warning,[{text:TYPO3.lang["button.cancel"]||"Cancel",active:!0,btnClass:"btn-default",name:"cancel",trigger:(t,n)=>{n.hideModal(),e(!1)}},{text:TYPO3.lang["button.delete"]||"Delete",btnClass:"btn-warning",name:"delete",trigger:(t,n)=>{n.hideModal(),e(!0)}}])})}promptWarning(e){return new Promise(t=>{const n=this.getChildLabel(e.childCount),a=TYPO3.lang["warning.prefix"]||"Warning:",r=(TYPO3.lang["warning.has_children"]||"This page has %d %s.").replaceAll("%d",`<strong>${e.childCount}</strong>`).replaceAll("%s",`<strong>${n}</strong>`),s=TYPO3.lang["warning.will_delete_all"]||"Deleting this page will also delete all its subpages and their content.",l=TYPO3.lang["warning.confirm"]||"Are you sure you want to proceed?",i=document.createElement("div");i.innerHTML=`
        <p><strong>${a}</strong> ${r}</p>
        <p>${s}</p>
        <p>${l}</p>
      `;const d=(TYPO3.lang["warning.title"]||'Delete page "%s"?').replaceAll("%s",e.pageTitle),u=(TYPO3.lang["button.delete_with_children"]||"Yes, delete page and %d %s").replaceAll("%d",e.childCount.toString()).replaceAll("%s",n);g.advanced({title:d,content:i,severity:o.warning,buttons:[{text:TYPO3.lang["button.cancel"]||"Cancel",active:!0,btnClass:"btn-default",name:"cancel",trigger:(h,c)=>{c.hideModal(),t(!1)}},{text:u,btnClass:`btn-${p.getCssClass(o.warning)}`,name:"delete",trigger:(h,c)=>{c.hideModal(),t(!0)}}]})})}showErrorModal(e){const t=this.getChildLabel(e.childCount),n=TYPO3.lang["error.prefix"]||"Error:",a=TYPO3.lang["error.not_allowed"]||"You are not allowed to delete pages with children.",r=(TYPO3.lang["error.has_children"]||"This page has %d %s and cannot be deleted.").replaceAll("%d",`<strong>${e.childCount}</strong>`).replaceAll("%s",`<strong>${t}</strong>`),s=TYPO3.lang["error.instruction"]||"Please delete the child pages first or contact your administrator for permissions.",l=document.createElement("div");l.innerHTML=`
      <p><strong>${n}</strong> ${a}</p>
      <p>${r}</p>
      <p>${s}</p>
    `,g.advanced({title:TYPO3.lang["error.title"]||"Deletion Not Allowed",content:l,severity:o.error,buttons:[{text:TYPO3.lang["button.ok"]||"OK",active:!0,btnClass:"btn-default",name:"ok",trigger:(i,d)=>{d.hideModal()}}]})}getChildLabel(e){return e===1?TYPO3.lang["label.subpage"]||"subpage":TYPO3.lang["label.subpages"]||"subpages"}}const Y=new w;export{Y as default};
